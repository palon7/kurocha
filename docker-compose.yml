services:
  kurocha:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
      args:
        NODE_VERSION: ${NODE_VERSION:-24}
        PNPM_VERSION: ${PNPM_VERSION:-10.25.0}
        CLAUDE_CODE_VERSION: ${CLAUDE_CODE_VERSION:-latest}
        GITHUB_CLI_VERSION: ${GITHUB_CLI_VERSION:-2.83.2}
    container_name: kurocha
    restart: unless-stopped
    environment:
      # Discord configuration
      - DISCORD_API_KEY=${DISCORD_API_KEY}
      - DISCORD_CHANNEL_ID=${DISCORD_CHANNEL_ID}
      - DISCORD_GUILD_ID=${DISCORD_GUILD_ID}
      # Claude configuration
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - WORKSPACE_ROOT=/workdir
      - CLAUDE_SKIP_PERMISSIONS=${CLAUDE_SKIP_PERMISSIONS:-false}
    volumes:
      - workspace:/workdir
      - claude-config:/home/claude/.claude
      - dot-config:/home/claude/.config
    security_opt:
      - no-new-privileges:true

# Named volumes for persistent data
volumes:
  claude-config:
  dot-config:
  workspace:
